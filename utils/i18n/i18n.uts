import { ref, reactive } from 'vue'

// 导入语言文件
import en from './en.json'
import zh from './zh.json'

// 定义支持的语言类型
type Language = 'en' | 'zh'

// 定义语言包类型
interface LangPack {
  [key: string]: any
}

// 存储当前语言
const currentLanguage = ref<Language>('en')

// 存储语言包
const langPacks: Record<Language, LangPack> = {
  en,
  zh
}

// 翻译函数
export const t = (key: string, defaultVal: string = key): string => {
  if (!key) return defaultVal
  
  const keys = key.split('.')
  let result: any = langPacks[currentLanguage.value]
  
  for (const k of keys) {
    if (result && typeof result === 'object' && k in result) {
      result = result[k]
    } else {
      return defaultVal
    }
  }
  
  return typeof result === 'string' ? result : defaultVal
}

// 切换语言
export const switchLanguage = (lang: Language): void => {
  currentLanguage.value = lang
  // 存储语言偏好到本地
  uni.setStorageSync('language', lang)
}

// 初始化语言
export const initLanguage = (): void => {
  // 从本地存储获取语言设置，默认使用英文
  const savedLang = uni.getStorageSync('language') as Language
  if (savedLang && ['en', 'zh'].includes(savedLang)) {
    currentLanguage.value = savedLang
  } else {
    // 默认使用英文
    currentLanguage.value = 'en'
    uni.setStorageSync('language', 'en')
  }
}

// 获取当前语言
export const getCurrentLanguage = (): Language => {
  return currentLanguage.value
}

// 获取语言显示名称
export const getLanguageDisplayName = (lang: Language): string => {
  const displayNames: Record<Language, string> = {
    en: 'English',
    zh: '简体中文'
  }
  return displayNames[lang]
}

// 获取所有支持的语言
export const getSupportedLanguages = (): { code: Language; name: string }[] => {
  return [
    { code: 'en', name: 'English' },
    { code: 'zh', name: '简体中文' }
  ]
}